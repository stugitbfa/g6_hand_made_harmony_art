{% extends 'web/base.html' %}
{% load static %}

{% block title %}Edit Profile{% endblock %}

{% block style %}
<style>
    .dropzone {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.3s;
        position: relative;
    }

    .dropzone.dragover {
        border-color: #007bff;
        background-color: #f0f8ff;
    }

    .dropzone img {
        max-width: 100px;
        height: 100px;
        object-fit: cover;
        margin-top: 10px;
        border-radius: 50%;
    }

    .dropzone input[type="file"] {
        display: none;
    }

    .dropzone-label {
        font-size: 14px;
        color: #888;
    }
</style>
{% endblock %}

{% block body %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h4 class="text-center mb-4">Edit Profile</h4>


                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        <!-- Profile Picture -->
                        <div class="mb-4 text-center">
                            <label class="form-label fw-bold">Profile Picture</label>
                            <br>

                            <!-- Clickable Profile Image -->
                            <label for="profile_picture" style="cursor: pointer;">
                                <img id="profilePreview" src="{{ profile.profile_picture.url }}" alt="Profile Picture"
                                    class="rounded-circle border shadow-sm mb-3"
                                    style="width: 150px; height: 150px; object-fit: cover;">
                            </label>

                            <!-- Drag & Drop Upload Area -->
                            <div id="dropArea" class="border border-2 rounded bg-light p-3 mx-auto"
                                style="border-style: dashed; max-width: 400px; cursor: pointer;">
                                <p class="mb-0 text-muted small">Drag & Drop your image here or click to upload</p>
                                <input type="file" name="profile_picture" id="profile_picture" accept="image/*"
                                    class="form-control d-none">
                            </div>
                            <div class="text-center mt-3">
                                <strong>{{ follower_count }}</strong> Followers |
                                <strong>{{ following_count }}</strong> Following
                            </div>

                        </div>


                        <!-- Artist Info -->
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" value="{{ artist.username }}"
                                readonly>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" value="{{ artist.email }}" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="mobile" class="form-label">Mobile</label>
                            <input type="text" class="form-control" id="mobile" name="mobile"
                                value="{{ artist.mobile }}">
                        </div>

                        <!-- Profile Info -->
                        <div class="mb-3">
                            <label for="gender" class="form-label">Gender</label>
                            <select class="form-select" id="gender" name="gender">
                                <option value="">Select Gender</option>
                                <option value="male" {% if profile.gender == 'male' %}selected{% endif %}>Male</option>
                                <option value="female" {% if profile.gender == 'female' %}selected{% endif %}>Female
                                </option>
                                <option value="other" {% if profile.gender == 'other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="date_of_birth" class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" id="date_of_birth" name="date_of_birth"
                                value="{{ profile.date_of_birth|date:'Y-m-d'|default:'2000-01-01' }}">
                        </div>

                        <div class="mb-3">
                            <label for="bio" class="form-label">Bio</label>
                            <textarea class="form-control" id="bio" name="bio" rows="3">{{ profile.bio }}</textarea>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-dark px-4">
                                <i class="fas fa-user-edit me-2"></i> Update Profile
                            </button>
                            <a href="{% url 'logout' %}" class="btn btn-danger ms-2">
                                <i class="fas fa-sign-out-alt me-2"></i> Logout
                            </a>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const dropArea = document.getElementById("dropArea");
    const fileInput = document.getElementById("profile_picture");
    const profilePreview = document.getElementById("profilePreview");

    // Click on drop area to trigger file input
    dropArea.addEventListener("click", () => fileInput.click());

    // Preview when file selected
    fileInput.addEventListener("change", function () {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                profilePreview.src = e.target.result;
            };
            reader.readAsDataURL(this.files[0]);
        }
    });

    // Handle drag & drop
    dropArea.addEventListener("dragover", function (e) {
        e.preventDefault();
        this.classList.add("bg-light");
    });

    dropArea.addEventListener("dragleave", function () {
        this.classList.remove("bg-light");
    });

    dropArea.addEventListener("drop", function (e) {
        e.preventDefault();
        this.classList.remove("bg-light");

        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
            fileInput.files = e.dataTransfer.files;

            const reader = new FileReader();
            reader.onload = function (e) {
                profilePreview.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
</script>

{% endblock %}